import{a as $,b as Y,c as q,d as J,e as H,f as Q,g as X,h as Z,i as ee,j as te,k as ie,l as ne,m as ae}from"./chunk-3QXJK43Q.js";import{a as se,b as le,c as ce,d as me,e as de,f as pe,g as _e}from"./chunk-5OVA7WMN.js";import{A as K,B as z,C as R,D as L,E as oe,T as re,r as V,u as B,v as A,w as N,x as G,y as W,z as j}from"./chunk-AWTQJJWB.js";import{Aa as S,Bb as I,Ea as f,Ga as d,Ha as l,N as p,O as _,Sa as b,Ua as a,Va as w,Wa as C,Xa as x,Ya as P,Za as M,a as y,b as k,ba as O,ca as m,ga as h,hb as F,ka as D,oa as v,pb as T,qb as E,sb as U,xa as g,ya as n,za as o}from"./chunk-I6VPMUNL.js";function fe(c,t){if(c&1){let e=f();n(0,"div",17)(1,"h3"),a(2,"Confirm Your Password"),o(),n(3,"p"),a(4,"Please enter your current password to confirm changes:"),o(),n(5,"mat-form-field")(6,"input",18),M("ngModelChange",function(r){p(e);let s=l();return P(s.passwordConfirmation,r)||(s.passwordConfirmation=r),_(r)}),o()(),n(7,"div",19)(8,"button",20),d("click",function(){p(e);let r=l();return _(r.cancelPasswordConfirmation())}),a(9," Cancel "),o()()()}if(c&2){let e=l();m(6),x("ngModel",e.passwordConfirmation)}}function ue(c,t){if(c&1){let e=f();n(0,"button",21),d("click",function(){p(e);let r=l();return _(r.showPasswordConfirmation())}),a(1," Update Profile "),o()}}function ve(c,t){if(c&1){let e=f();n(0,"button",21),d("click",function(){p(e);let r=l();return _(r.updateUser())}),a(1," Confirm Update "),o()}}function he(c,t){if(c&1){let e=f();n(0,"button",22),d("click",function(){p(e);let r=l();return _(r.showPasswordConfirmation())}),a(1," Delete Account "),o()}}function Ce(c,t){if(c&1){let e=f();n(0,"button",22),d("click",function(){p(e);let r=l();return _(r.deleteUser())}),a(1," Confirm Delete "),o()}}function xe(c,t){c&1&&(n(0,"div",23)(1,"p"),a(2,"Loading your favorite movies..."),o()())}function Pe(c,t){c&1&&(n(0,"div",24)(1,"p"),a(2,"You haven't added any movies to your favorites yet."),o(),n(3,"p"),a(4,"Go to the movies page and click the heart icon to add some!"),o()())}function Me(c,t){if(c&1){let e=f();n(0,"div",30),S(1,"img",31),n(2,"div",32)(3,"h3",33),a(4),o(),n(5,"p",34),a(6),o(),n(7,"div",35)(8,"button",36),d("click",function(r){p(e);let s=l().$implicit;return l(2).toggleFavorite(s),_(r.stopPropagation())}),n(9,"mat-icon"),a(10,"favorite"),o()(),n(11,"button",37),d("click",function(r){p(e);let s=l().$implicit;return l(2).openSynopsisDialog(s),_(r.stopPropagation())}),n(12,"mat-icon"),a(13,"visibility"),o()(),n(14,"button",38),d("click",function(r){p(e);let s=l().$implicit;return l(2).openDirectorDialog(s.Director),_(r.stopPropagation())}),n(15,"mat-icon"),a(16,"person"),o()(),n(17,"button",39),d("click",function(r){p(e);let s=l().$implicit;return l(2).openGenreDialog(s.Genre),_(r.stopPropagation())}),n(18,"mat-icon"),a(19,"category"),o()(),n(20,"mat-icon",40),a(21,"expand_more"),o()()()()}if(c&2){let e=l().$implicit,i=l(2);m(),g("src",e.ImagePath,O)("alt",e.Title),m(3),w(e.Title),m(2),w(e.Director==null?null:e.Director.Name),m(3),b("favorite-filled",i.isFavorite(e.Title))}}function be(c,t){if(c&1&&(n(0,"p")(1,"strong"),a(2,"Director Bio:"),o(),a(3),o()),c&2){let e=l(2).$implicit;m(3),C(" ",e.Director.Bio)}}function we(c,t){if(c&1){let e=f();n(0,"div",41),S(1,"img",42),n(2,"mat-card-header")(3,"mat-card-title"),a(4),o(),n(5,"mat-card-subtitle"),a(6),o()(),n(7,"mat-card-content")(8,"p")(9,"strong"),a(10,"Genre:"),o(),a(11),o(),n(12,"p")(13,"strong"),a(14,"Description:"),o(),a(15),o(),v(16,be,4,1,"p",43),o(),n(17,"mat-card-actions")(18,"button",44),d("click",function(r){p(e);let s=l().$implicit;return l(2).openGenreDialog(s.Genre),_(r.stopPropagation())}),a(19," Genre Details "),o(),n(20,"button",44),d("click",function(r){p(e);let s=l().$implicit;return l(2).openDirectorDialog(s.Director),_(r.stopPropagation())}),a(21," Director Details "),o(),n(22,"button",44),d("click",function(r){p(e);let s=l().$implicit;return l(2).openSynopsisDialog(s),_(r.stopPropagation())}),a(23," Full Synopsis "),o(),n(24,"button",45),d("click",function(r){p(e);let s=l().$implicit;return l(2).toggleFavorite(s),_(r.stopPropagation())}),n(25,"mat-icon"),a(26,"favorite"),o()(),n(27,"button",46),d("click",function(r){p(e);let s=l().$implicit;return l(2).toggleCard(s._id),_(r.stopPropagation())}),n(28,"mat-icon"),a(29,"expand_less"),o()()()()}if(c&2){let e=l().$implicit,i=l(2);m(),g("src",e.ImagePath,O)("alt",e.Title),m(3),w(e.Title),m(2),C("Directed by: ",e.Director==null?null:e.Director.Name),m(5),C(" ",e.Genre==null?null:e.Genre.Name),m(4),C(" ",e.Description),m(),g("ngIf",e.Director==null?null:e.Director.Bio),m(9),b("favorite-filled",i.isFavorite(e.Title))}}function ye(c,t){if(c&1){let e=f();n(0,"mat-card",27),d("click",function(){let r=p(e).$implicit,s=l(2);return _(s.openSynopsisDialog(r))}),v(1,Me,22,6,"div",28)(2,we,30,9,"div",29),o()}if(c&2){let e=t.$implicit,i=l(2);b("expanded",i.isExpanded(e._id)),m(),g("ngIf",!i.isExpanded(e._id)),m(),g("ngIf",i.isExpanded(e._id))}}function Oe(c,t){if(c&1&&(n(0,"div",25),v(1,ye,3,4,"mat-card",26),o()),c&2){let e=l();m(),g("ngForOf",e.favoriteMovies)("ngForTrackBy",e.trackByMovieId)}}var ge=class c{constructor(t,e,i,r,s){this.fetchApiData=t;this.snackBar=e;this.router=i;this.cdr=r;this.dialog=s}user={};userData={};favoriteMovies=[];loadingFavorites=!0;passwordConfirmation="";showPasswordField=!1;expandedCards=new Set;userFavorites=new Set;ngOnInit(){this.getUser()}getUser(){let t=JSON.parse(localStorage.getItem("user")||"{}");if(this.user=t,this.userData=y({},t),this.userData.Birthday){let e=new Date(this.userData.Birthday);this.userData.Birthday=e.toISOString().split("T")[0]}this.getFavoriteMovies()}updateUser(){if(!this.passwordConfirmation){this.snackBar.open("Please enter your password to confirm changes","OK",{duration:3e3});return}let t=k(y({},this.userData),{Password:this.passwordConfirmation});this.fetchApiData.editUser(this.user.Username,t).subscribe({next:e=>{localStorage.setItem("user",JSON.stringify(e)),this.user=e,this.passwordConfirmation="",this.showPasswordField=!1,this.cdr.detectChanges(),this.snackBar.open("Profile updated successfully!","OK",{duration:2e3})},error:e=>{console.error("Update error:",e);let i="Failed to update profile";e.error&&e.error.message&&(i=e.error.message),this.snackBar.open(i,"OK",{duration:3e3})}})}deleteUser(){if(!this.passwordConfirmation){this.snackBar.open("Please enter your password to confirm account deletion","OK",{duration:3e3});return}confirm("Are you sure you want to delete your account? This action cannot be undone.")&&this.fetchApiData.deleteUser(this.user.Username).subscribe({next:t=>{localStorage.clear(),this.snackBar.open("Account deleted successfully","OK",{duration:2e3}),window.location.href="/welcome"},error:t=>{console.error("Delete error:",t),this.snackBar.open("Failed to delete account","OK",{duration:3e3})}})}getFavoriteMovies(){this.user.Username?(this.loadingFavorites=!0,this.fetchApiData.getFavoriteMovies(this.user.Username).subscribe({next:t=>{let e=[];Array.isArray(t)?e=t:t&&t.FavoriteMovies&&Array.isArray(t.FavoriteMovies)?e=t.FavoriteMovies:t&&t.movies&&Array.isArray(t.movies)&&(e=t.movies),e.length>0?this.fetchFullMovieDetails(e):(this.favoriteMovies=[],this.loadingFavorites=!1)},error:t=>{console.error("Error loading favorites:",t),this.loadingFavorites=!1,this.favoriteMovies=[]}})):this.loadingFavorites=!1}fetchFullMovieDetails(t){this.fetchApiData.getAllMovies().subscribe({next:e=>{this.favoriteMovies=e.filter(i=>t.includes(i._id)),this.userFavorites.clear(),this.favoriteMovies.forEach(i=>{this.userFavorites.add(i.Title)}),this.loadingFavorites=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading all movies:",e),this.loadingFavorites=!1,this.cdr.detectChanges()}})}showPasswordConfirmation(){this.showPasswordField=!0}cancelPasswordConfirmation(){this.showPasswordField=!1,this.passwordConfirmation=""}goToMovies(){this.expandedCards.clear(),this.router.navigate(["/movies"])}logout(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.snackBar.open("Logged out successfully!","OK",{duration:2e3}),this.router.navigate(["/welcome"])}openGenreDialog(t){this.dialog.open(de,{width:"500px",data:t})}openDirectorDialog(t){this.dialog.open(pe,{width:"500px",data:t})}openSynopsisDialog(t){this.dialog.open(_e,{width:"500px",maxHeight:"80vh",data:t})}toggleCard(t){this.expandedCards.has(t)?this.expandedCards.delete(t):this.expandedCards.add(t)}isExpanded(t){return this.expandedCards.has(t)}trackByMovieId(t,e){return e._id||t}isFavorite(t){return this.userFavorites.has(t)}addToFavorites(t){let e=JSON.parse(localStorage.getItem("user")||"{}");this.fetchApiData.addFavoriteMovie(e.Username,t.Title).subscribe({next:i=>{this.userFavorites.add(t.Title),this.cdr.detectChanges(),this.snackBar.open("Added to favorites!","OK",{duration:2e3})},error:i=>{console.error("Error adding to favorites:",i),this.snackBar.open("Failed to add to favorites","OK",{duration:3e3})}})}removeFromFavorites(t){let e=JSON.parse(localStorage.getItem("user")||"{}");this.fetchApiData.deleteFavoriteMovie(e.Username,t.Title).subscribe({next:i=>{this.userFavorites.delete(t.Title),this.favoriteMovies=this.favoriteMovies.filter(r=>r._id!==t._id),this.cdr.detectChanges(),this.snackBar.open("Removed from favorites!","OK",{duration:2e3})},error:i=>{console.error("Error removing from favorites:",i),this.snackBar.open("Failed to remove from favorites","OK",{duration:3e3})}})}toggleFavorite(t){this.isFavorite(t.Title)?this.removeFromFavorites(t):this.addToFavorites(t)}static \u0275fac=function(e){return new(e||c)(h(oe),h(ae),h(I),h(F),h(re))};static \u0275cmp=D({type:c,selectors:[["app-user-profile"]],decls:39,vars:11,consts:[[1,"profile-container"],[1,"header-section"],[1,"header-buttons"],["mat-raised-button","","color","primary",1,"back-button",3,"click"],["mat-raised-button","","color","warn",1,"logout-button",3,"click"],[1,"profile-card"],[1,"profile-form"],["matInput","","placeholder","Username","name","Username","required","",3,"ngModelChange","ngModel"],["matInput","","placeholder","Email","name","Email","type","email","required","",3,"ngModelChange","ngModel"],["matInput","","placeholder","Birthday","name","Birthday","type","date",3,"ngModelChange","ngModel"],["class","password-confirmation",4,"ngIf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],[1,"favorites-card"],["class","loading-favorites",4,"ngIf"],["class","no-favorites",4,"ngIf"],["class","favorites-grid",4,"ngIf"],[1,"password-confirmation"],["matInput","","placeholder","Current Password","name","PasswordConfirmation","type","password","required","",3,"ngModelChange","ngModel"],[1,"password-actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[1,"loading-favorites"],[1,"no-favorites"],[1,"favorites-grid"],["class","movie-card",3,"expanded","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"movie-card",3,"click"],["class","movie-thumbnail",4,"ngIf"],["class","movie-expanded",4,"ngIf"],[1,"movie-thumbnail"],[1,"thumbnail-image",3,"src","alt"],[1,"thumbnail-overlay"],[1,"thumbnail-title"],[1,"thumbnail-director"],[1,"thumbnail-actions"],["mat-icon-button","","color","warn","matTooltip","Toggle Favorites",1,"favorite-btn",3,"click"],["mat-icon-button","","matTooltip","View Details",1,"view-more-btn",3,"click"],["mat-icon-button","","matTooltip","Director Info",1,"director-btn",3,"click"],["mat-icon-button","","matTooltip","Genre Info",1,"genre-btn",3,"click"],[1,"expand-icon"],[1,"movie-expanded"],["mat-card-image","",1,"expanded-image",3,"src","alt"],[4,"ngIf"],["mat-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-icon-button","",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),a(3,"User Profile"),o(),n(4,"div",2)(5,"button",3),d("click",function(){return i.goToMovies()}),n(6,"mat-icon"),a(7,"home"),o(),a(8," Home "),o(),n(9,"button",4),d("click",function(){return i.logout()}),n(10,"mat-icon"),a(11,"logout"),o(),a(12," Logout "),o()()(),n(13,"mat-card",5)(14,"mat-card-header")(15,"mat-card-title"),a(16,"Profile Details"),o()(),n(17,"mat-card-content")(18,"form",6)(19,"mat-form-field")(20,"input",7),M("ngModelChange",function(s){return P(i.userData.Username,s)||(i.userData.Username=s),s}),o()(),n(21,"mat-form-field")(22,"input",8),M("ngModelChange",function(s){return P(i.userData.Email,s)||(i.userData.Email=s),s}),o()(),n(23,"mat-form-field")(24,"input",9),M("ngModelChange",function(s){return P(i.userData.Birthday,s)||(i.userData.Birthday=s),s}),o()()(),v(25,fe,10,1,"div",10),o(),n(26,"mat-card-actions"),v(27,ue,2,0,"button",11)(28,ve,2,0,"button",11)(29,he,2,0,"button",12)(30,Ce,2,0,"button",12),o()(),n(31,"mat-card",13)(32,"mat-card-header")(33,"mat-card-title"),a(34,"Favorite Movies"),o()(),n(35,"mat-card-content"),v(36,xe,3,0,"div",14)(37,Pe,5,0,"div",15)(38,Oe,2,2,"div",16),o()()()),e&2&&(m(20),x("ngModel",i.userData.Username),m(2),x("ngModel",i.userData.Email),m(2),x("ngModel",i.userData.Birthday),m(),g("ngIf",i.showPasswordField),m(2),g("ngIf",!i.showPasswordField),m(),g("ngIf",i.showPasswordField),m(),g("ngIf",!i.showPasswordField),m(),g("ngIf",i.showPasswordField),m(6),g("ngIf",i.loadingFavorites),m(),g("ngIf",!i.loadingFavorites&&i.favoriteMovies.length===0),m(),g("ngIf",!i.loadingFavorites&&i.favoriteMovies.length>0))},dependencies:[L,N,K,W,z,R,j,G,Y,$,ne,ie,A,B,V,te,Z,q,J,H,ee,X,Q,U,T,E,le,se,me,ce],styles:[".profile-container[_ngcontent-%COMP%]{min-height:100vh;padding:2rem;background:linear-gradient(135deg,#0f0f23,#0a0a1a,#05050f)}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;max-width:800px;margin-left:auto;margin-right:auto}h1[_ngcontent-%COMP%]{color:#fff;font-size:2.5em;margin:0;font-family:Crimson Pro,serif}.header-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.back-button[_ngcontent-%COMP%], .logout-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.logout-button[_ngcontent-%COMP%]{background-color:#d32f2f!important;color:#fff!important}.logout-button[_ngcontent-%COMP%]:hover{background-color:#b71c1c!important}.logout-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff!important}.profile-card[_ngcontent-%COMP%], .favorites-card[_ngcontent-%COMP%]{width:100%;max-width:800px;padding:2rem;margin:0 auto 2rem}.profile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}mat-card-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;margin-top:1rem}.password-confirmation[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:#f8f9fa;border-radius:8px;border-left:4px solid #ff9800}.password-confirmation[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#333;font-family:Crimson Pro,serif}h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{font-family:Crimson Pro,serif}mat-card-title[_ngcontent-%COMP%]{font-family:Crimson Pro,serif}.password-confirmation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;color:#666;font-size:.9rem}.password-actions[_ngcontent-%COMP%]{margin-top:1rem;text-align:right}.loading-favorites[_ngcontent-%COMP%], .no-favorites[_ngcontent-%COMP%]{text-align:center;color:#666;padding:2rem}.favorites-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.5rem;margin-top:1rem}.movie-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px #00000026;transition:all .3s ease;cursor:pointer;position:relative}.movie-card[_ngcontent-%COMP%]:hover{transform:translateY(-8px);box-shadow:0 8px 25px #0003}.movie-card.expanded[_ngcontent-%COMP%]{grid-column:1/-1;max-width:800px;margin:0 auto;width:100%}.movie-thumbnail[_ngcontent-%COMP%]{position:relative;height:400px;overflow:hidden}.thumbnail-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.thumbnail-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,#000c);color:#fff;padding:1.5rem 1rem 1rem;transform:translateY(100%);transition:transform .3s ease}.movie-card[_ngcontent-%COMP%]:hover   .thumbnail-overlay[_ngcontent-%COMP%]{transform:translateY(0)}.thumbnail-title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.1rem;font-weight:600;line-height:1.2;font-family:Crimson Pro,serif}.thumbnail-director[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9rem;opacity:.9}.thumbnail-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.5rem}.favorite-btn[_ngcontent-%COMP%], .view-more-btn[_ngcontent-%COMP%], .director-btn[_ngcontent-%COMP%], .genre-btn[_ngcontent-%COMP%]{background:#0009;border-radius:50%;width:2.5rem;height:2.5rem;min-width:2.5rem}.favorite-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .view-more-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .director-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .genre-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff;font-size:1.2rem}.favorite-filled[_ngcontent-%COMP%]{color:#f44336!important}.expand-icon[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#0009;border-radius:50%;padding:.5rem;font-size:1.5rem;width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center}.movie-expanded[_ngcontent-%COMP%]   .expanded-image[_ngcontent-%COMP%]{height:300px;object-fit:cover}.movie-expanded[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 0}.movie-expanded[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-family:Crimson Pro,serif}.movie-expanded[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:1rem 1.5rem}.movie-expanded[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;line-height:1.5}.movie-expanded[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;padding:1rem 1.5rem 1.5rem;gap:.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.header-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem;width:100%}.back-button[_ngcontent-%COMP%], .logout-button[_ngcontent-%COMP%]{width:100%;justify-content:center}h1[_ngcontent-%COMP%]{font-size:2em}.profile-container[_ngcontent-%COMP%]{padding:1rem}.favorites-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem}.movie-thumbnail[_ngcontent-%COMP%]{height:300px}}"]})};export{ge as UserProfileComponent};
